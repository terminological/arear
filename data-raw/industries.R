# 2015 spatial
# https://www.ons.gov.uk/employmentandlabourmarket/peopleinwork/employmentandemployeetypes/articles/thespatialdistributionofindustriesingreatbritain/2015

# https://www.ons.gov.uk/employmentandlabourmarket/peopleinwork/employmentandemployeetypes/datasets/employmentbyindustryemp13


# https://www.nomisweb.co.uk/api/v01/dataset/NM_17_5.data.csv?geography=1811939329...1811939332,1811939334...1811939336,1811939338...1811939497,1811939499...1811939501,1811939503,1811939505...1811939507,1811939509...1811939517,1811939519,1811939520,1811939524...1811939570,1811939575...1811939599,1811939601...1811939628,1811939630...1811939634,1811939636...1811939647,1811939649,1811939655...1811939664,1811939667...1811939680,1811939682,1811939683,1811939685,1811939687...1811939704,1811939707,1811939708,1811939710,1811939712...1811939717,1811939719,1811939720,1811939722...1811939730&date=latestMINUS3-latest&variable=45,84,1532...1540&measures=20599,21001,21002,21003
url = "https://www.nomisweb.co.uk/api/v01/dataset/NM_17_5.data.csv?geography=1811939329...1811939332,1811939334...1811939336,1811939338...1811939497,1811939499...1811939501,1811939503,1811939505...1811939507,1811939509...1811939517,1811939519,1811939520,1811939524...1811939570,1811939575...1811939599,1811939601...1811939628,1811939630...1811939634,1811939636...1811939647,1811939649,1811939655...1811939664,1811939667...1811939680,1811939682,1811939683,1811939685,1811939687...1811939704,1811939707,1811939708,1811939710,1811939712...1811939717,1811939719,1811939720,1811939722...1811939730&date=latestMINUS3-latest&variable=45,84,1532...1540&measures=20599,21001,21002,21003"
jobs = readr::read_csv(url)


# industries by region
# https://www.nomisweb.co.uk/api/v01/dataset/NM_131_1.data.csv?geography=2013265921...2013265932,2092957697...2092957703&date=latestMINUS8-latest&industry=150994945...150994964&sex=7&item=1&measures=20100
url2 = "https://www.nomisweb.co.uk/api/v01/dataset/NM_131_1.data.csv?geography=2013265921...2013265932,2092957697...2092957703&date=latestMINUS8-latest&industry=150994945...150994964&sex=7&item=1&measures=20100"
industries = readr::read_csv(url2)

# annual population survey - regional - employment by occupation
# https://www.nomisweb.co.uk/query/construct/apilinks.asp?menuopt=201
# third level occupation and counts
url3 = "https://www.nomisweb.co.uk/api/v01/dataset/NM_168_1.data.csv?geography=2092957697...2092957703,2013265921...2013265932&date=latest&c_sex=0&c_occpuk11h_0=0,1000001,100000,10000...10007,100001,10008...10011,2000000,200000,20000...20004,2000001,20005...20007,200002,20008,200003,20009...20015,3000000,300000,30000...30002,300001,30003,30004,300003,30005,300004,30006...30008,300005,30009...30014,4000000,400000,40000...40004,400001,40005,5000000,500000,50000,500001,50001...50005,500005,50006...50008,500009,50009...50012,6000000,600000,60000...60002,600002,60003...60006,7000000,700000,70000...70002,700002,70003,70004,8000000,800000,80000...80003,800002,80004...80006,9000000,900000,90000...90002,900002,90003...90008&measure=1,3&measures=20100,20701"
ind2  = readr::read_csv(url3)

# Claimant count by sex and age
# https://www.nomisweb.co.uk/query/construct/apilinks.asp?menuopt=201
url4 = "https://www.nomisweb.co.uk/api/v01/dataset/NM_162_1.data.csv?geography=1811939329...1811939332,1811939334...1811939336,1811939338...1811939497,1811939499...1811939501,1811939503,1811939505...1811939507,1811939509...1811939517,1811939519,1811939520,1811939524...1811939570,1811939575...1811939599,1811939601...1811939628,1811939630...1811939634,1811939636...1811939647,1811939649,1811939655...1811939664,1811939667...1811939680,1811939682,1811939683,1811939685,1811939687...1811939704,1811939707,1811939708,1811939710,1811939712...1811939717,1811939719,1811939720,1811939722...1811939730,1811939757...1811939767&date=latestMINUS13-latest&gender=0&age=0&measure=1,2&measures=20100"

url4 = "https://www.nomisweb.co.uk/api/v01/dataset/NM_162_1.data.csv?geography=1811939329...1811939332,1811939334...1811939336,1811939338...1811939497,1811939499...1811939501,1811939503,1811939505...1811939507,1811939509...1811939517,1811939519,1811939520,1811939524...1811939570,1811939575...1811939599,1811939601...1811939628,1811939630...1811939634,1811939636...1811939647,1811939649,1811939655...1811939664,1811939667...1811939680,1811939682,1811939683,1811939685,1811939687...1811939704,1811939707,1811939708,1811939710,1811939712...1811939717,1811939719,1811939720,1811939722...1811939730,1811939757...1811939767&date=latestMINUS11-latest&gender=0&age=0&measure=1,2&measures=20100"
unemploymentTimeseries = #readr::read_csv(url4)
nomisr::nomis_get_data(id="NM_162_1",geography=LTLAs,time=c("latestMINUS11","latest"), measures = 20100, gender=0, age=0, measure=c(1,2), select=c("date","geography_name","geography_code","measure_name","obs_value","obs_status_name"))

# Data downloads
# annual population survey
# url5 = "http://www.nomisweb.co.uk/api/v01/dataset/NM_17_5.data.tsv?geography=1811939329...1811939332,1811939334...1811939336,1811939338...1811939497,1811939499...1811939501,1811939503,1811939505...1811939507,1811939509...1811939517,1811939519,1811939520,1811939524...1811939570,1811939575...1811939599,1811939601...1811939628,1811939630...1811939634,1811939636...1811939647,1811939649,1811939655...1811939664,1811939667...1811939680,1811939682,1811939683,1811939685,1811939687...1811939704,1811939707,1811939708,1811939710,1811939712...1811939717,1811939719,1811939720,1811939722...1811939730&date=latest&variable=45,1541...1565,1532...1540,1329...1338,84&measures=20599,21001,21002,21003&select=date_name,geography_name,geography_code,variable_name,measures_name,obs_value,obs_status_name"
# workforceByIndustryByLTLA = readr::read_csv(url5)
#
#
# url5 = "http://www.nomisweb.co.uk/api/v01/dataset/NM_17_5.data.csv?geography=1811939329...1811939332,1811939334...1811939336,1811939338...1811939497,1811939499...1811939501,1811939503,1811939505...1811939507,1811939509...1811939517,1811939519,1811939520,1811939524...1811939570,1811939575...1811939599,1811939601...1811939628,1811939630...1811939634,1811939636...1811939647,1811939649,1811939655...1811939664,1811939667...1811939680,1811939682,1811939683,1811939685,1811939687...1811939704,1811939707,1811939708,1811939710,1811939712...1811939717,1811939719,1811939720,1811939722...1811939730&date=latest&variable=45&measures=20599,21001,21002,21003&select=date_name,geography_name,geography_code,variable_name,measures_name,obs_value,obs_status_name"
# url6 = "http://www.nomisweb.co.uk/api/v01/dataset/NM_17_5.data.csv?geography=1811939329...1811939332,1811939334...1811939336,1811939338...1811939497,1811939499...1811939501,1811939503,1811939505...1811939507,1811939509...1811939517,1811939519,1811939520,1811939524...1811939570,1811939575...1811939599,1811939601...1811939628,1811939630...1811939634,1811939636...1811939647,1811939649,1811939655...1811939664,1811939667...1811939680,1811939682,1811939683,1811939685,1811939687...1811939704,1811939707,1811939708,1811939710,1811939712...1811939717,1811939719,1811939720,1811939722...1811939730&date=latest&variable=1541...1565&measures=20599,21001,21002,21003&select=date_name,geography_name,geography_code,variable_name,measures_name,obs_value,obs_status_name"
# url7 = "http://www.nomisweb.co.uk/api/v01/dataset/NM_17_5.data.csv?geography=1811939329...1811939332,1811939334...1811939336,1811939338...1811939497,1811939499...1811939501,1811939503,1811939505...1811939507,1811939509...1811939517,1811939519,1811939520,1811939524...1811939570,1811939575...1811939599,1811939601...1811939628,1811939630...1811939634,1811939636...1811939647,1811939649,1811939655...1811939664,1811939667...1811939680,1811939682,1811939683,1811939685,1811939687...1811939704,1811939707,1811939708,1811939710,1811939712...1811939717,1811939719,1811939720,1811939722...1811939730&date=latest&variable=1532...1540&measures=20599,21001,21002,21003&select=date_name,geography_name,geography_code,variable_name,measures_name,obs_value,obs_status_name"
# url8 = "http://www.nomisweb.co.uk/api/v01/dataset/NM_17_5.data.csv?geography=1811939329...1811939332,1811939334...1811939336,1811939338...1811939497,1811939499...1811939501,1811939503,1811939505...1811939507,1811939509...1811939517,1811939519,1811939520,1811939524...1811939570,1811939575...1811939599,1811939601...1811939628,1811939630...1811939634,1811939636...1811939647,1811939649,1811939655...1811939664,1811939667...1811939680,1811939682,1811939683,1811939685,1811939687...1811939704,1811939707,1811939708,1811939710,1811939712...1811939717,1811939719,1811939720,1811939722...1811939730&date=latest&variable=1329...1338&measures=20599,21001,21002,21003&select=date_name,geography_name,geography_code,variable_name,measures_name,obs_value,obs_status_name"
# url9 = "http://www.nomisweb.co.uk/api/v01/dataset/NM_17_5.data.csv?geography=1811939329...1811939332,1811939334...1811939336,1811939338...1811939497,1811939499...1811939501,1811939503,1811939505...1811939507,1811939509...1811939517,1811939519,1811939520,1811939524...1811939570,1811939575...1811939599,1811939601...1811939628,1811939630...1811939634,1811939636...1811939647,1811939649,1811939655...1811939664,1811939667...1811939680,1811939682,1811939683,1811939685,1811939687...1811939704,1811939707,1811939708,1811939710,1811939712...1811939717,1811939719,1811939720,1811939722...1811939730&date=latest&variable=84&measures=20599,21001,21002,21003&select=date_name,geography_name,geography_code,variable_name,measures_name,obs_value,obs_status_name"

workforceByIndustryByLTLA = readr::read_csv(url5)

#https://cran.r-project.org/web/packages/nomisr/nomisr.pdf

LTLAs = as.character(c(1811939329:1811939332,1811939334:1811939336,1811939338:1811939497,1811939499:1811939501,1811939503,1811939505:1811939507,1811939509:1811939517,1811939519,1811939520,1811939524:1811939570,1811939575:1811939599,1811939601:1811939628,1811939630:1811939634,1811939636:1811939647,1811939649,1811939655:1811939664,1811939667:1811939680,1811939682,1811939683,1811939685,1811939687:1811939704,1811939707,1811939708,1811939710,1811939712:1811939717,1811939719,1811939720,1811939722:1811939730))


# employed, unemployed, industry distribution by LTLA
# over whole of 2020
tmp = nomisr::nomis_get_data(id = "NM_17_5", geography = LTLAs, date = "latest", measures = c(21001,21002), variable=c(45,84,1329:1338,1532:1565), select=c("date_name","geography_name","geography_code","variable_name","measures_name","obs_value","obs_status_name"))



