<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Create a map, usually as a chloropleth, with selected areas labelled. — plotLabelledMap • arear</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Create a map, usually as a chloropleth, with selected areas labelled. — plotLabelledMap"><meta name="description" content="This can be used to pick out specific highlighted regions based on a filter,
label it on a map using a short code, and provide a tabular lookup of label
to full name."><meta property="og:description" content="This can be used to pick out specific highlighted regions based on a filter,
label it on a map using a short code, and provide a tabular lookup of label
to full name."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">arear</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.4.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/arear.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/terminological/arear/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Create a map, usually as a chloropleth, with selected areas labelled.</h1>
      <small class="dont-index">Source: <a href="https://github.com/terminological/arear/blob/HEAD/R/arear.R" class="external-link"><code>R/arear.R</code></a></small>
      <div class="d-none name"><code>plotLabelledMap.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This can be used to pick out specific highlighted regions based on a filter,
label it on a map using a short code, and provide a tabular lookup of label
to full name.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">plotLabelledMap</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  <span class="va">mapping</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  <span class="va">labelMapping</span>,</span>
<span>  labelStyle <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  labelSort <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  labels <span class="op">=</span> <span class="fl">6</span>,</span>
<span>  labelSize <span class="op">=</span> <span class="fl">6</span>,</span>
<span>  tableSize <span class="op">=</span> <span class="fl">6</span>,</span>
<span>  labelInset <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"both"</span>, <span class="st">"inset"</span>, <span class="st">"main"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>A sf object with some data in it. If using facets this should be
grouped. (and if it is grouped faceting will be automatically added)</p></dd>


<dt id="arg-mapping">mapping<a class="anchor" aria-label="anchor" href="#arg-mapping"></a></dt>
<dd><p>the aesthetics as would be passed to `geom_sf`</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>additional formatting parameters as would be passed to `geom_sf`
(defaults to a thin grey line for the edge of the maps.)</p></dd>


<dt id="arg-labelmapping">labelMapping<a class="anchor" aria-label="anchor" href="#arg-labelmapping"></a></dt>
<dd><p>the aesthetics of the label layer. This could include any
aesthetics that apply to `ggrepel::geom_label_repel` other than `x`,`y`..
It must include a label aesthetic (which will go on the map) and a name
aesthetic (which will go in the lookup table)</p></dd>


<dt id="arg-labelstyle">labelStyle<a class="anchor" aria-label="anchor" href="#arg-labelstyle"></a></dt>
<dd><p>any additional formatting parameters that would be passed
to `ggrepel::geom_label_repel`. Defaults to a blue label on a light
transparent background which works for dark maps. A
`list(segment.colour = "cyan", colour="cyan", fill=="#000000A0")`
should give a cyan label on a dark transparent background which might work
for lighter maps.</p></dd>


<dt id="arg-labelsort">labelSort<a class="anchor" aria-label="anchor" href="#arg-labelsort"></a></dt>
<dd><p>(optional) how should we sort the labels . This defaults to
the descending order of the same variable that determines the fill of the
main map. This should be a simple expression that you might use for
`dplyr::arrange` and can include `desc` for descending.</p></dd>


<dt id="arg-labels">labels<a class="anchor" aria-label="anchor" href="#arg-labels"></a></dt>
<dd><p>how many labels do you want, per facet. The default 6 is good
for a small number of facets. This will be overridden if `labelFilter` is
specified</p></dd>


<dt id="arg-labelsize">labelSize<a class="anchor" aria-label="anchor" href="#arg-labelsize"></a></dt>
<dd><p>in points.</p></dd>


<dt id="arg-tablesize">tableSize<a class="anchor" aria-label="anchor" href="#arg-tablesize"></a></dt>
<dd><p>the labels and the other data from all facets will
be assembled into a table as a ggplot/patchwork object. This defines the
font size (in points) of this table. No other config is allowed.</p></dd>


<dt id="arg-labelinset">labelInset<a class="anchor" aria-label="anchor" href="#arg-labelinset"></a></dt>
<dd><p>if a map has an zoomed in inset as produced by
`popoutArea()`, for areas which are in both the main map and the inset you
may wish to label only the zoomed area in the "inset", only the unzoomed
area in the "main" map or "both" (the default).</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>a list containing 4 items. Plot and legend may be added together to
  form a ggplot patchwork. e.g. `p = plotLabelledMap(...)` then
  `p$plot+ggplot2::scale_fill_viridis_c()+ggplot2::facet_wrap(dplyr::vars(...))+p$legend+patchwork::plot_annotation(taglevels="A")`
  to actually show the map.</p><dl><dt>plot</dt>
<dd><p>a ggplot object showing a chloropleth (usually) which is
  defined by the main mapping aesthetics, with an overlaid labelling layer
  defined by the `labelMapping` label aesthetic. This does not include fill or
  colour scales so you will probably want `plot+ggplot2::scale_fill_viridis_c()`
  or something similar to define the fill</p></dd>
. If the input data is grouped this
  plot will be facetted by group.
  <dt>legend</dt>
<dd><p>a ggplot patchwork containing the lookup table from labels
  to other data (as determined by the `labelMapping` aesthetics)</p></dd>

  <dt>labelDf</dt>
<dd><p>the filtered dataframe of the labels appearing in the
  labelling layer. The .x and .y columns are added which show where the
  label is placed on the main map. the .label and .name show the labels
  and names respectively</p></dd>

  <dt>labeller</dt>
<dd><p>A function that returns a layer of the labels, formatted
  in same way as the main map. the labeller function takes optional xVar
  and yVar parameter which are columns in the sf object. These define the
  x and y aesthetics of the labeller and default to the same position as
  the main map. The labeller function can be used to add a labels layer to
  a different map, or to a different graph. This might be useful if you want
  to combine cartograms with points of interest and have them consistently
  labelled.</p></dd>


</dl></div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># create some test data:</span></span></span>
<span class="r-in"><span><span class="va">tmp</span> <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>,</span></span>
<span class="r-in"><span>  <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="va">testdata</span><span class="op">$</span><span class="va">diamond11x11</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>set <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"set %d"</span>,<span class="va">i</span><span class="op">)</span>, value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">set</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%s-%s"</span>, <span class="va">letters</span><span class="op">[</span><span class="va">x</span><span class="op">+</span><span class="fl">6</span><span class="op">]</span>, <span class="va">letters</span><span class="op">[</span><span class="va">y</span><span class="op">+</span><span class="fl">6</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">)</span><span class="op">+</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">set</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="plotLabelledMap-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">p</span> <span class="op">=</span> <span class="fu">plotLabelledMap</span><span class="op">(</span></span></span>
<span class="r-in"><span>  data <span class="op">=</span> <span class="va">tmp</span>,</span></span>
<span class="r-in"><span>  mapping <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">value</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  labelMapping <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>label<span class="op">=</span><span class="va">name</span>,percent<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%1.1f%%"</span>,<span class="va">value</span><span class="op">*</span><span class="fl">100</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  labels <span class="op">=</span> <span class="fl">2</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>st_centroid assumes attributes are constant over geometries</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>st_centroid does not give correct centroids for longitude/latitude data</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">p</span><span class="op">$</span><span class="va">plot</span><span class="op">+</span><span class="va">p</span><span class="op">$</span><span class="va">legend</span></span></span>
<span class="r-plt img"><img src="plotLabelledMap-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Robert Challen.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

